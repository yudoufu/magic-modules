<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Handwritten IAM support is only recommended for resources that cannot be managed using MMv1."><meta name=theme-color content="#FFFFFF"><meta name=color-scheme content="light dark"><meta property="og:title" content="Add handwritten IAM resources"><meta property="og:description" content="Handwritten IAM support is only recommended for resources that cannot be managed using MMv1."><meta property="og:type" content="article"><meta property="og:url" content="https://googlecloudplatform.github.io/magic-modules/docs/how-to/add-handwritten-iam/"><meta property="article:section" content="docs"><meta property="article:modified_time" content="2022-12-01T08:20:21-08:00"><title>Add handwritten IAM resources | Magic Modules</title><link rel=manifest href=/magic-modules/manifest.json><link rel=icon href=/magic-modules/favicon.png type=image/x-icon><link rel=stylesheet href=/magic-modules/book.min.c58292d36b18b675680ab9baea2029204537b839ea72f258746ec0f32ce8d6c8.css integrity="sha256-xYKS02sYtnVoCrm66iApIEU3uDnqcvJYdG7A8yzo1sg=" crossorigin=anonymous><script defer src=/magic-modules/flexsearch.min.js></script>
<script defer src=/magic-modules/en.search.min.2f653af129452131d2b57b9c0e9fa9ec37004674da72f2dff61bdc033552be6e.js integrity="sha256-L2U68SlFITHStXucDp+p7DcARnTacvLf9hvcAzVSvm4=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/magic-modules/><img src=/magic-modules/magic-modules.svg alt=Logo><span>Magic Modules</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><span>Getting Started</span><ul><li><a href=/magic-modules/docs/getting-started/setup/>Set up your environment</a></li><li><a href=/magic-modules/docs/getting-started/generate-providers/>Generate the providers</a></li><li><a href=/magic-modules/docs/getting-started/run-provider-tests/>Run provider tests</a></li><li><a href=/magic-modules/docs/getting-started/use-built-provider/>Use built provider</a></li><li><a href=/magic-modules/docs/getting-started/contributing/>Contributing</a></li><li><a href=/magic-modules/docs/getting-started/provider-documentation/>Provider documentation</a></li></ul></li><li><a href=/magic-modules/docs/how-to/>How To</a><ul><li><a href=/magic-modules/docs/how-to/types-of-resources/>Types of resources</a></li><li><a href=/magic-modules/docs/how-to/add-mmv1-resource/>Add an MMv1 resource</a></li><li><a href=/magic-modules/docs/how-to/add-mmv1-iam/>Add MMv1 IAM resources</a></li><li><a href=/magic-modules/docs/how-to/add-mmv1-test/>Add an MMv1 test</a></li><li><a href=/magic-modules/docs/how-to/mmv1-resource-documentation/>Add and update MMv1 resource documentation</a></li><li><a href=/magic-modules/docs/how-to/update-handwritten-resource/>Update a handwritten resource</a></li><li><a href=/magic-modules/docs/how-to/add-handwritten-test/>Add a handwritten test</a></li><li><a href=/magic-modules/docs/how-to/add-handwritten-datasource/>Add a handwritten datasource</a></li><li><a href=/magic-modules/docs/how-to/add-handwritten-iam/ class=active>Add handwritten IAM resources</a></li><li><a href=/magic-modules/docs/how-to/update-handwritten-documentation/>Update handwritten provider documentation</a></li><li><a href=/magic-modules/docs/how-to/add-handwritten-datasource-documentation/>Add documentation for a handwritten data source</a></li></ul></li><li><a href=/magic-modules/docs/best-practices/>Best practices</a><ul></ul></li><li><span>Reference</span><ul><li><a href=https://github.com/GoogleCloudPlatform/magic-modules/blob/main/mmv1/api/resource.rb target=_blank rel=noopener>ResourceName.yaml resource â†—</a></li></ul></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/magic-modules/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Add handwritten IAM resources</strong>
<label for=toc-control><img src=/magic-modules/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents></nav></aside></header><article class=markdown><h1 id=add-handwritten-iam-resources>Add handwritten IAM resources
<a class=anchor href=#add-handwritten-iam-resources>#</a></h1><p>Handwritten IAM support is only recommended for resources that cannot be managed
using <a href=/magic-modules/docs/how-to/add-mmv1-iam>MMv1</a>,
including for handwritten resources, due to the need to manage tests and
documentation by hand. This guidance goes through the motions of adding support
for new handwritten IAM resources, but does not go into the details of the
implementation as any new handwritten IAM resources are expected to be
exceptional.</p><p>IAM resources are implemented using an IAM framework, where you implement an
interface for each parent resource supporting <code>getIamPolicy</code>/<code>setIamPolicy</code> and
the associated IAM resources that target that parent resource- <code>_member</code>,
<code>_binding</code>, and <code>_policy</code>- are created by the framework.</p><p>To add support for a new target, create a new file in
<code>mmv1/third_party/terraform/utils</code> called <code>iam_{{resource}}.go</code>, and implement
the <code>ResourceIamUpdater</code>, <code>newResourceIamUpdaterFunc</code>, <code>iamPolicyModifyFunc</code>,
<code>resourceIdParserFunc</code> interfaces from
<a href=https://github.com/GoogleCloudPlatform/magic-modules/blob/main/mmv1/third_party/terraform/utils/iam.go.erb>https://github.com/GoogleCloudPlatform/magic-modules/blob/main/mmv1/third_party/terraform/utils/iam.go.erb</a>
in public types, alongside a public <code>map[string]*schema.Schema</code> containing all
fields referenced in the resource.</p><p>Once your implementation is complete, add the IAM resources to <code>provider.go</code>
inside the <code>START non-generated IAM resources</code> block, creating the concrete
resource types using the <code>ResourceIamMember</code>, <code>ResourceIamBinding</code>, and
<code>ResourceIamPolicy</code> functions. For example:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span>				<span style=color:#e6db74>&#34;google_bigtable_instance_iam_binding&#34;</span>:         <span style=color:#a6e22e>ResourceIamBinding</span>(<span style=color:#a6e22e>IamBigtableInstanceSchema</span>, <span style=color:#a6e22e>NewBigtableInstanceUpdater</span>, <span style=color:#a6e22e>BigtableInstanceIdParseFunc</span>),
</span></span><span style=display:flex><span>				<span style=color:#e6db74>&#34;google_bigtable_instance_iam_member&#34;</span>:          <span style=color:#a6e22e>ResourceIamMember</span>(<span style=color:#a6e22e>IamBigtableInstanceSchema</span>, <span style=color:#a6e22e>NewBigtableInstanceUpdater</span>, <span style=color:#a6e22e>BigtableInstanceIdParseFunc</span>),
</span></span><span style=display:flex><span>				<span style=color:#e6db74>&#34;google_bigtable_instance_iam_policy&#34;</span>:          <span style=color:#a6e22e>ResourceIamPolicy</span>(<span style=color:#a6e22e>IamBigtableInstanceSchema</span>, <span style=color:#a6e22e>NewBigtableInstanceUpdater</span>, <span style=color:#a6e22e>BigtableInstanceIdParseFunc</span>),
</span></span></code></pre></div><p>Following that, write a test for each resource exercising create and update for
both <code>_policy</code> and <code>_binding</code>, and create for <code>_member</code>. No special
accommodations are needed for the IAM test compared to a normal Terraform
resource test.</p><p>Documentation for IAM resources is done using single page per target resource,
rather than a distinct page for each IAM resource level. As most of the page is
standard, you can generally copy and edit an existing handwritten page such as
<a href=https://github.com/GoogleCloudPlatform/magic-modules/blob/main/mmv1/third_party/terraform/website/docs/r/bigtable_instance_iam.html.markdown>https://github.com/GoogleCloudPlatform/magic-modules/blob/main/mmv1/third_party/terraform/website/docs/r/bigtable_instance_iam.html.markdown</a>
to write the documentation.</p></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/GoogleCloudPlatform/magic-modules/commit/b516d46d92ea9aaa0ddc5f52100c9ea8e68d5ca5 title='Last modified by Stephen Lewis (Burrows) | December 1, 2022' target=_blank rel=noopener><img src=/magic-modules/svg/calendar.svg class=book-icon alt=Calendar>
<span>December 1, 2022</span></a></div><div><a class="flex align-center" href=https://github.com/GoogleCloudPlatform/magic-modules/edit/main/docs/content/docs/how-to/add-handwritten-iam.md target=_blank rel=noopener><img src=/magic-modules/svg/edit.svg class=book-icon alt=Edit>
<span>Edit this page</span></a></div></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents></nav></div></aside></main></body></html>