<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="For handwritten resources and generated resources that need to test update, handwritten tests must be added."><meta name=theme-color content="#FFFFFF"><meta name=color-scheme content="light dark"><meta property="og:title" content="Add a handwritten test"><meta property="og:description" content="For handwritten resources and generated resources that need to test update, handwritten tests must be added."><meta property="og:type" content="article"><meta property="og:url" content="https://googlecloudplatform.github.io/magic-modules/docs/how-to/add-handwritten-test/"><meta property="article:section" content="docs"><meta property="article:modified_time" content="2023-04-06T12:27:28-07:00"><title>Add a handwritten test | Magic Modules</title><link rel=manifest href=/magic-modules/manifest.json><link rel=icon href=/magic-modules/favicon.png type=image/x-icon><link rel=stylesheet href=/magic-modules/book.min.c58292d36b18b675680ab9baea2029204537b839ea72f258746ec0f32ce8d6c8.css integrity="sha256-xYKS02sYtnVoCrm66iApIEU3uDnqcvJYdG7A8yzo1sg=" crossorigin=anonymous><script defer src=/magic-modules/flexsearch.min.js></script>
<script defer src=/magic-modules/en.search.min.2f653af129452131d2b57b9c0e9fa9ec37004674da72f2dff61bdc033552be6e.js integrity="sha256-L2U68SlFITHStXucDp+p7DcARnTacvLf9hvcAzVSvm4=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/magic-modules/><img src=/magic-modules/magic-modules.svg alt=Logo><span>Magic Modules</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><span>Getting Started</span><ul><li><a href=/magic-modules/docs/getting-started/setup/>Set up your environment</a></li><li><a href=/magic-modules/docs/getting-started/generate-providers/>Generate the providers</a></li><li><a href=/magic-modules/docs/getting-started/run-provider-tests/>Run provider tests</a></li><li><a href=/magic-modules/docs/getting-started/use-built-provider/>Use built provider</a></li><li><a href=/magic-modules/docs/getting-started/contributing/>Contributing</a></li><li><a href=/magic-modules/docs/getting-started/provider-documentation/>Provider documentation</a></li></ul></li><li><a href=/magic-modules/docs/how-to/>How To</a><ul><li><a href=/magic-modules/docs/how-to/types-of-resources/>Types of resources</a></li><li><a href=/magic-modules/docs/how-to/add-mmv1-resource/>Add an MMv1 resource</a></li><li><a href=/magic-modules/docs/how-to/add-mmv1-iam/>Add MMv1 IAM resources</a></li><li><a href=/magic-modules/docs/how-to/add-mmv1-test/>Add an MMv1 test</a></li><li><a href=/magic-modules/docs/how-to/mmv1-resource-documentation/>Add and update MMv1 resource documentation</a></li><li><a href=/magic-modules/docs/how-to/update-handwritten-resource/>Update a handwritten resource</a></li><li><a href=/magic-modules/docs/how-to/add-handwritten-test/ class=active>Add a handwritten test</a></li><li><a href=/magic-modules/docs/how-to/add-handwritten-datasource/>Add a handwritten datasource</a></li><li><a href=/magic-modules/docs/how-to/add-handwritten-iam/>Add handwritten IAM resources</a></li><li><a href=/magic-modules/docs/how-to/update-handwritten-documentation/>Update handwritten provider documentation</a></li><li><a href=/magic-modules/docs/how-to/add-handwritten-datasource-documentation/>Add documentation for a handwritten data source</a></li></ul></li><li><a href=/magic-modules/docs/best-practices/>Best practices</a><ul></ul></li><li><span>Reference</span><ul><li><a href=https://github.com/GoogleCloudPlatform/magic-modules/blob/main/mmv1/api/resource.rb target=_blank rel=noopener>ResourceName.yaml resource â†—</a></li></ul></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/magic-modules/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Add a handwritten test</strong>
<label for=toc-control><img src=/magic-modules/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#simple-tests>Simple Tests</a></li><li><a href=#update-tests>Update tests</a></li><li><a href=#testing-beta-features>Testing Beta Features</a></li></ul></nav></aside></header><article class=markdown><h1 id=add-a-handwritten-test>Add a handwritten test
<a class=anchor href=#add-a-handwritten-test>#</a></h1><p>For handwritten resources and generated resources that need to test update,
handwritten tests must be added.</p><p>Tests are made up of a templated Terraform configuration where unique values
like GCE names are passed in as arguments, and boilerplate to exercise that
configuration.</p><p>The test boilerplate effectively does the following:</p><ol><li>Run <code>terraform apply</code> on the configuration, waiting for it to succeed and
recording the results in Terraform state</li><li>Run <code>terraform plan</code>, and fail if Terraform detects any drift</li><li>Clear the resource from state and run <code>terraform import</code> on it</li><li>Deeply compare the original state from <code>terraform apply</code> and the <code>terraform import</code> results, returning an error if any values are not identical</li><li>Destroy all resources in the configuration using <code>terraform destroy</code>,
waiting for the destroy command to succeed</li><li>Call <code>GET</code> on the resource, and fail the test if it is still present</li></ol><h2 id=simple-tests>Simple Tests
<a class=anchor href=#simple-tests>#</a></h2><p>Terraform configurations are stored as string constants wrapped in Go functions
like the following:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>testAccComputeFirewall_basic</span>(<span style=color:#a6e22e>network</span>, <span style=color:#a6e22e>firewall</span> <span style=color:#66d9ef>string</span>) <span style=color:#66d9ef>string</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Sprintf</span>(<span style=color:#e6db74>`
</span></span></span><span style=display:flex><span><span style=color:#e6db74>resource &#34;google_compute_network&#34; &#34;foobar&#34; {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  name                    = &#34;%s&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  auto_create_subnetworks = false
</span></span></span><span style=display:flex><span><span style=color:#e6db74>}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>resource &#34;google_compute_firewall&#34; &#34;foobar&#34; {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  name        = &#34;%s&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  description = &#34;Resource created for Terraform acceptance testing&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  network     = google_compute_network.foobar.name
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  source_tags = [&#34;foo&#34;]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  allow {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    protocol = &#34;icmp&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>`</span>, <span style=color:#a6e22e>network</span>, <span style=color:#a6e22e>firewall</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>For the most part, you can copy and paste a preexisting test case and modify it.
For example, the following test case is a good reference:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>TestAccComputeFirewall_noSource</span>(<span style=color:#a6e22e>t</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>testing</span>.<span style=color:#a6e22e>T</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>t</span>.<span style=color:#a6e22e>Parallel</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>networkName</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Sprintf</span>(<span style=color:#e6db74>&#34;tf-test-firewall-%s&#34;</span>, <span style=color:#a6e22e>RandString</span>(<span style=color:#a6e22e>t</span>, <span style=color:#ae81ff>10</span>))
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>firewallName</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Sprintf</span>(<span style=color:#e6db74>&#34;tf-test-firewall-%s&#34;</span>, <span style=color:#a6e22e>RandString</span>(<span style=color:#a6e22e>t</span>, <span style=color:#ae81ff>10</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>VcrTest</span>(<span style=color:#a6e22e>t</span>, <span style=color:#a6e22e>resource</span>.<span style=color:#a6e22e>TestCase</span>{
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>PreCheck</span>:                 <span style=color:#66d9ef>func</span>() { <span style=color:#a6e22e>AccTestPreCheck</span>(<span style=color:#a6e22e>t</span>) },
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>ProtoV5ProviderFactories</span>: <span style=color:#a6e22e>ProtoV5ProviderFactories</span>(<span style=color:#a6e22e>t</span>),
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>CheckDestroy</span>:             <span style=color:#a6e22e>testAccCheckComputeFirewallDestroyProducer</span>(<span style=color:#a6e22e>t</span>),
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>Steps</span>: []<span style=color:#a6e22e>resource</span>.<span style=color:#a6e22e>TestStep</span>{
</span></span><span style=display:flex><span>            {
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>Config</span>: <span style=color:#a6e22e>testAccComputeFirewall_noSource</span>(<span style=color:#a6e22e>networkName</span>, <span style=color:#a6e22e>firewallName</span>),
</span></span><span style=display:flex><span>            },
</span></span><span style=display:flex><span>            {
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>ResourceName</span>:      <span style=color:#e6db74>&#34;google_compute_firewall.foobar&#34;</span>,
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>ImportState</span>:       <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>ImportStateVerify</span>: <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>            },
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>testAccComputeFirewall_noSource</span>(<span style=color:#a6e22e>network</span>, <span style=color:#a6e22e>firewall</span> <span style=color:#66d9ef>string</span>) <span style=color:#66d9ef>string</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Sprintf</span>(<span style=color:#e6db74>`
</span></span></span><span style=display:flex><span><span style=color:#e6db74>resource &#34;google_compute_network&#34; &#34;foobar&#34; {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  name                    = &#34;%s&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  auto_create_subnetworks = false
</span></span></span><span style=display:flex><span><span style=color:#e6db74>}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>resource &#34;google_compute_firewall&#34; &#34;foobar&#34; {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  name        = &#34;%s&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  description = &#34;Resource created for Terraform acceptance testing&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  network     = google_compute_network.foobar.name
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  allow {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    protocol = &#34;tcp&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    ports    = [22]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>`</span>, <span style=color:#a6e22e>network</span>, <span style=color:#a6e22e>firewall</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=update-tests>Update tests
<a class=anchor href=#update-tests>#</a></h2><p>Inside of a test, additional steps can be added in order to transition between
Terraform configurations, updating the stored state as it progresses. This
allows you to exercise update behaviour. This modifies the flow from before:</p><ol><li>Start with an empty Terraform state</li><li>For each <code>Config</code> and <code>ImportState</code> pair:<ol><li>Run <code>terraform apply</code> on the configuration, waiting for it to succeed
and recording the results in Terraform state</li><li>Run <code>terraform plan</code>, and fail if Terraform detects any drift</li><li>Clear the resource from state and run <code>terraform import</code> on it</li><li>Deeply compare the original state from <code>terraform apply</code> and the
<code>terraform import</code> results, returning an error if any values are not
identical</li></ol></li><li>Destroy all resources in the configuration using <code>terraform destroy</code>,
waiting for the destroy command to succeed</li><li>Call <code>GET</code> on the resource, and fail the test if it is still present</li></ol><p>For example:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>TestAccComputeFirewall_disabled</span>(<span style=color:#a6e22e>t</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>testing</span>.<span style=color:#a6e22e>T</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>t</span>.<span style=color:#a6e22e>Parallel</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>networkName</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Sprintf</span>(<span style=color:#e6db74>&#34;tf-test-firewall-%s&#34;</span>, <span style=color:#a6e22e>RandString</span>(<span style=color:#a6e22e>t</span>, <span style=color:#ae81ff>10</span>))
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>firewallName</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Sprintf</span>(<span style=color:#e6db74>&#34;tf-test-firewall-%s&#34;</span>, <span style=color:#a6e22e>RandString</span>(<span style=color:#a6e22e>t</span>, <span style=color:#ae81ff>10</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>VcrTest</span>(<span style=color:#a6e22e>t</span>, <span style=color:#a6e22e>resource</span>.<span style=color:#a6e22e>TestCase</span>{
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>PreCheck</span>:                 <span style=color:#66d9ef>func</span>() { <span style=color:#a6e22e>AccTestPreCheck</span>(<span style=color:#a6e22e>t</span>) },
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>ProtoV5ProviderFactories</span>: <span style=color:#a6e22e>ProtoV5ProviderFactories</span>(<span style=color:#a6e22e>t</span>),
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>CheckDestroy</span>:             <span style=color:#a6e22e>testAccCheckComputeFirewallDestroyProducer</span>(<span style=color:#a6e22e>t</span>),
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>Steps</span>: []<span style=color:#a6e22e>resource</span>.<span style=color:#a6e22e>TestStep</span>{
</span></span><span style=display:flex><span>            {
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>Config</span>: <span style=color:#a6e22e>testAccComputeFirewall_disabled</span>(<span style=color:#a6e22e>networkName</span>, <span style=color:#a6e22e>firewallName</span>),
</span></span><span style=display:flex><span>            },
</span></span><span style=display:flex><span>            {
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>ResourceName</span>:      <span style=color:#e6db74>&#34;google_compute_firewall.foobar&#34;</span>,
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>ImportState</span>:       <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>ImportStateVerify</span>: <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>            },
</span></span><span style=display:flex><span>            {
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>Config</span>: <span style=color:#a6e22e>testAccComputeFirewall_basic</span>(<span style=color:#a6e22e>networkName</span>, <span style=color:#a6e22e>firewallName</span>),
</span></span><span style=display:flex><span>            },
</span></span><span style=display:flex><span>            {
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>ResourceName</span>:      <span style=color:#e6db74>&#34;google_compute_firewall.foobar&#34;</span>,
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>ImportState</span>:       <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>ImportStateVerify</span>: <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>            },
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>testAccComputeFirewall_basic</span>(<span style=color:#a6e22e>network</span>, <span style=color:#a6e22e>firewall</span> <span style=color:#66d9ef>string</span>) <span style=color:#66d9ef>string</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Sprintf</span>(<span style=color:#e6db74>`
</span></span></span><span style=display:flex><span><span style=color:#e6db74>resource &#34;google_compute_network&#34; &#34;foobar&#34; {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  name                    = &#34;%s&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  auto_create_subnetworks = false
</span></span></span><span style=display:flex><span><span style=color:#e6db74>}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>resource &#34;google_compute_firewall&#34; &#34;foobar&#34; {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  name        = &#34;%s&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  description = &#34;Resource created for Terraform acceptance testing&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  network     = google_compute_network.foobar.name
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  source_tags = [&#34;foo&#34;]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  allow {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    protocol = &#34;icmp&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>`</span>, <span style=color:#a6e22e>network</span>, <span style=color:#a6e22e>firewall</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>testAccComputeFirewall_disabled</span>(<span style=color:#a6e22e>network</span>, <span style=color:#a6e22e>firewall</span> <span style=color:#66d9ef>string</span>) <span style=color:#66d9ef>string</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Sprintf</span>(<span style=color:#e6db74>`
</span></span></span><span style=display:flex><span><span style=color:#e6db74>resource &#34;google_compute_network&#34; &#34;foobar&#34; {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  name                    = &#34;%s&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  auto_create_subnetworks = false
</span></span></span><span style=display:flex><span><span style=color:#e6db74>}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>resource &#34;google_compute_firewall&#34; &#34;foobar&#34; {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  name        = &#34;%s&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  description = &#34;Resource created for Terraform acceptance testing&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  network     = google_compute_network.foobar.name
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  source_tags = [&#34;foo&#34;]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  allow {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    protocol = &#34;icmp&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  disabled = true
</span></span></span><span style=display:flex><span><span style=color:#e6db74>}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>`</span>, <span style=color:#a6e22e>network</span>, <span style=color:#a6e22e>firewall</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=testing-beta-features>Testing Beta Features
<a class=anchor href=#testing-beta-features>#</a></h2><p>If you worked with a beta feature and had to use beta version guards in a
handwritten resource or set <code>min_version: beta</code> in a generated resource, you&rsquo;ll
want to version guard both the test case and configuration by enclosing them in
ERB tags like below. Additionally, if the filename ends in <code>.go</code>, rename it to
end in <code>.go.erb</code>.</p><pre tabindex=0><code>&lt;% unless version == &#39;ga&#39; -%&gt;
// test case + config here
&lt;% end -%&gt;
</code></pre><p>Otherwise, tests using a beta feature are written exactly the same as tests
using a GA one. Normally to use the beta provider, it&rsquo;s necessary to specify
<code>provider = google-beta</code>, as Terraform maps any resources prefixed with
<code>google_</code> to the <code>google</code> provider by default. However, inside the test
framework, the <code>google-beta</code> provider has been aliased as the <code>google</code> provider
and that is not necessary.</p><p>Note: You <em>may</em> use version guards to test different configurations between the
GA and beta provider tests, but it&rsquo;s strongly recommended that you write
different test cases instead, even if they&rsquo;re slightly duplicative.</p></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/GoogleCloudPlatform/magic-modules/commit/1264e9f0935c01d247841a86b70a68b439162df4 title='Last modified by Zhenhua Li | April 6, 2023' target=_blank rel=noopener><img src=/magic-modules/svg/calendar.svg class=book-icon alt=Calendar>
<span>April 6, 2023</span></a></div><div><a class="flex align-center" href=https://github.com/GoogleCloudPlatform/magic-modules/edit/main/docs/content/docs/how-to/add-handwritten-test.md target=_blank rel=noopener><img src=/magic-modules/svg/edit.svg class=book-icon alt=Edit>
<span>Edit this page</span></a></div></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#simple-tests>Simple Tests</a></li><li><a href=#update-tests>Update tests</a></li><li><a href=#testing-beta-features>Testing Beta Features</a></li></ul></nav></div></aside></main></body></html>